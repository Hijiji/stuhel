<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Stuhel</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
    <!-- SimpleLightbox plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <!--로그인폼-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js" crossorigin="anonymous"></script>
    <!--sweet alert-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<style>
</style>
</head>
<body id="page-top">
<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container px-4 px-lg-5">
        <!--<a class="navbar-brand" href="#page-top">welcome to here</a>-->
        <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto my-2 my-lg-0">
                <li class="nav-item"><a class="nav-link" href="#login">로그인</a></li>
                <li class="nav-item"><a class="nav-link" href="#join">회원가입</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- WELCOME-->
<header class="masthead">
    <div class="container px-4 px-lg-5 h-100">
        <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
            <div class="col-lg-8 align-self-end">
                <h1 class="text-white font-weight-bold">Study Helper</h1>
                <hr class="divider" />
            </div>
            <div class="col-lg-8 align-self-baseline">
                <p class="text-white-75 mb-5">STUDY HELPER에 오신걸 환영합니다.</br> 로그인 후 사용할 수 있습니다.</p>
                <a class="btn btn-primary btn-xl" href="#login" onclick="moveNextSpot(loginId)">login</a>
            </div>
        </div>
    </div>
</header>
<!--LOGIN-->
<section class="page-section bg-primary" id="login">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8 text-center">
                <h2 class="text-white mt-0">Login</h2>
                <hr class="divider divider-light"/>
                        <form>
                            <div class="form-floating mb-3">
                                <input class="form-control" id="loginId" type="identity" onkeyup="moveNextSpot(loginPassword)" placeholder="ID" />
                                <label for="loginId">ID</label>
                            </div>
                            <div class="form-floating mb-3">
                                <input class="form-control" id="loginPassword" type="password" onkeyup="moveNextSpot(loginButton)" placeholder="Password" />
                                <label for="loginPassword">Password</label>
                            </div>
                    <!--             <div class="form-check mb-3">
                                     <input class="form-check-input" id="inputRememberPassword" type="checkbox" value="" />
                                     <label class="form-check-label" for="inputRememberPassword" style="text-aline:left">Remember Password</label>
                                 </div>
                                 <div class="d-flex align-items-center justify-content-between mt-4 mb-0">
                                     <a class="small" href="password.html">Forgot Password?</a>
                                 </div>
                    -->
                             <div>
                                <div class="text-center mb-3">
                                    <div class="fw-bolder" id="loginMsg" style="color:#1a1e21; font-size:18px;"></div>
                                </div>
                            </div>
                            <input type="button" class="btn btn-light btn-xl" id="loginButton" onfocus="loginOnclick()" value="Login"/>  <!--href="index.html"-->
                            <a class="btn btn-primary btn-xl" href="#join">회원가입</a>
                        </form>
            </div>
        </div>
    </div>
</section>
<!-- Join-->
<section class="page-section" id="join">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8 col-xl-6 text-center">
                <h2 class="mt-0">회원가입</h2>
                <hr class="divider" />
                <p class="text-muted mb-5">원활한 회원가입을 위해 모든 항목을 기입해주시기바랍니다.</p>
            </div>
        </div>
        <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
            <div class="col-lg-6">
                <form id="joinForm" data-sb-form-api-token="API_TOKEN">
                    <!-- Name input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="newMemberName" type="text" onkeyup="moveNextSpot(newMemberId)"
                               maxlength="20" placeholder="Enter your name..." data-sb-validations="required" />
                        <label for="newMemberName">Full name</label>
                    </div>
                    <!-- ID input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="newMemberId" type="identity" onkeyup="moveNextSpot(idDoubleCheck)" placeholder="ID" data-sb-validations="required" />
                        <label for="newMemberId">ID</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input class="btn btn-primary btn-xl" type="button" id="idDoubleCheck" onclick="idDoubleCheckClick()"value="ID중복확인"/>
                    </div>
                    <!-- Password input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="newMemberPassword" type="password" onkeyup="moveNextSpot(pwDoubleCheck)" placeholder="newMemberPassword" data-sb-validations="required"/>
                        <label for="newMemberPassword">Password</label>
                    </div>
                    <!-- Password confirm input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="pwDoubleCheck" type="password"  placeholder="Password-Check" onkeyup="moveNextSpot(newMemberBirth)" data-sb-validations="required" />
                        <label for="pwDoubleCheck">Password-Check</label>
                    </div>
                    <!-- BirthDay input-->
                    <div class="form-floating mb-3">
                        <input class="form-control" id="newMemberBirth" type="birth" placeholder="Birth" data-sb-validations="required" />
                        <label for="newMemberBirth">Birth</label>
                    </div>
                    <!--결과메세지-->
                    <div>
                        <div class="text-center mb-3">
                            <div class="fw-bolder" id="joinResultMessage" style="color:tomato; font-size:18px;"></div>
                        </div>
                    </div>
                    <!-- member join insert-->
                    <div class="d-grid"><input type="button"class="btn btn-primary btn-xl" onclick="newMemberInfoSubmit()" value="완료" /></div>
                </form>
            </div>
        </div>

    </div>
</section>

<!-- Footer-->
<footer class="bg-light py-5">
    <div class="container px-4 px-lg-5"><div class="small text-center text-muted">Copyright &copy; 2022 - isjiji</div></div>
</footer>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- SimpleLightbox plugin JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script src="js/common.js"></script>
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>

<script>
    const loginButton = document.querySelector("#loginButton");
    const loginId = document.querySelector("#loginId");
    const loginPassword = document.querySelector("#loginPassword");
    const loginMsg = document.querySelector("#loginMsg");

    const newMemberName = document.querySelector("#newMemberName");
    const newMemberId = document.querySelector("#newMemberId");
    const idDoubleCheck =document.querySelector("#idDoubleCheck");
    const newMemberPassword = document.querySelector("#newMemberPassword");
    const newMemberBirth = document.querySelector("#newMemberBirth");
    const pwDoubleCheck = document.querySelector("#pwDoubleCheck");
    const joinResultMsg = document.querySelector("#joinResultMessage");
    let idCheckInfo = new Object();

    function loginOnclick(){
       if(loginPassword.value.trim()==null||loginPassword.value.trim()=="" ||
           loginId.value.trim()==null||loginId.value.trim()==""
       ){
           loginMsg.innerHTML = "※ ID 혹은 비밀번호를 입력해주세요";
           return;
       }else{
           let loginData = {"password":loginPassword.value, "id":loginId.value};
           loginData = JSON.stringify(loginData);

           let xhr = new XMLHttpRequest();
           xhr.open('GET', "/member/login?loginData=" + encodeURI(loginData)
               ,true);
           xhr.setRequestHeader('Accept', 'application/json');
           xhr.send();
           xhr.onreadystatechange = () => {
               if (xhr.readyState == 4 && xhr.status == 200) {
                   let errorInfo = xhr.responseText;
                   errorInfo = JSON.parse(errorInfo);
                   console.log(errorInfo.errorCd);
                   console.log(errorInfo.errorMsg);
                   if (errorInfo.errorCd == 'Y' ) {
                      loginMsg.innerHTML = "※ " + errorInfo.errorMsg;
                       return;
                   } else {
                      location.href="/stuhel/home/home.html";
                   }
               }
           }
       }
    }

    function idDoubleCheckClick(){
        var regExp=/^[a-z0-9]*$/;

        if(newMemberId.value.trim()==""||newMemberId.value.trim()==null){
            joinResultMsg.innerHTML="ID를 입력해주세요";
            idDoubleCheck.value="ID중복확인";
            newMemberId.focus();
            return;
        }else if( !regExp.test(newMemberId.value.trim()) || newMemberId.value.trim().length < 5 ||newMemberId.value.trim().length > 20){
            joinResultMsg.innerHTML = "※ 아이디는 5~20자 영문 소문자와 숫자만으로 구성되어야합니다.";
            idDoubleCheck.value="ID중복확인";
            newMemberId.focus();
            return;
        }
        let xhr = new XMLHttpRequest();
        xhr.open('Get', "/member/idDoubleCheck?"
            + "memberId=" + encodeURI(newMemberId.value)
            ,true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.send();
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // 데이터 확인
                let errorInfo = xhr.responseText;
                console.log(errorInfo);
                errorInfo = JSON.parse(errorInfo);
                if (errorInfo.errorCode == 'Y') {
                    joinResultMsg.innerHTML="※ 이미 사용중인 아이디입니다.";
                    idDoubleCheck.value="ID중복확인";
                    newMemberId.focus();
                    return;
                }
                joinResultMsg.innerHTML="※ 사용 가능한 아이디입니다.";
                idCheckInfo.usableId=newMemberId.value; <!--ID중복체크 후, ID입력값을 변경했을 경우 중복 재검사를 위한 데이터-->
                idDoubleCheck.value="사용가능";
                newMemberPassword.focus();
            }
        }
    }

    function newMemberInfoSubmit(){
        if (newMemberId.value.trim()==""||newMemberId.value==null
                ||newMemberName.value.trim()==""||newMemberName.value==null
                ||newMemberPassword.value.trim()==""||newMemberPassword.value==null
                ||newMemberBirth.value.trim()==""||newMemberBirth.value==null){

            joinResultMsg.innerHTML = "※ 빈칸이 있습니다. </br>모든 정보를 기입하세요.";
            return;
        } else if(idDoubleCheck.value != "사용가능"){
            joinResultMsg.innerHTML = "※ 아이디 중복 검사가 필요합니다.";
            return;
        } else if(idCheckInfo.usableId.trim() != newMemberId.value.trim()){
            joinResultMsg.innerHTML = "※ 아이디 중복 검사를 재실행해주세요.";
            idDoubleCheck.value="중복확인";
            return;
        } else if (newMemberPassword.value != pwDoubleCheck.value) {
            joinResultMsg.innerHTML = "※ 비밀번호를 다시 확인해주세요";
            return;
        }else if(isNaN(newMemberBirth.value)||newMemberBirth.value.length != 8){
            joinResultMsg.innerHTML="※ 생년월일에는 8자리 숫자만 입력가능합니다. ex) 19450815";
            return;
        }else {
            let joinData ={"id" : newMemberId.value, "name" : newMemberName.value, "password" : newMemberPassword.value, "birth" : newMemberBirth.value};
            joinData = JSON.stringify(joinData);
            let xhr = new XMLHttpRequest();
            xhr.open('POST', "/member/join?"
                                 + "joinData=" + encodeURI(joinData)
                , true);
            xhr.setRequestHeader('Accept', 'application/json');
            xhr.send();
            xhr.onreadystatechange = () => {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    let errorInfo = xhr.responseText;
                    errorInfo = JSON.parse(errorInfo);
                    if (errorInfo.errorCode == 'Y') {
                        joinResultMsg.innerHTML = "※"+errorInfo.errorMsg;
                        return;
                    }
                    joinResultMsg.innerHTML = "ヽ(✿ﾟ▽ﾟ)ノ</br>회원가입에 성공했습니다";
                    idDoubleCheck.value = "ID중복확인";
                    newMemberId.value=null;
                    newMemberName.value=null;
                    newMemberPassword.value=null;
                    newMemberBirth.value=null;
                    pwDoubleCheck.value=null;

                    swal({
                          title : '회원가입 성공'
                        , text : 'ヽ(✿ﾟ▽ﾟ)ノ 로그인 후 이용해주세요'
                        , icon : 'success'
                        , button : '로그인'
                        , buttonColor : '#FAED7D'
                    }).then(function() {
                        location.href = "#login";
                    });
                }
            }
        }
    };

</script>
</body>
</html>
