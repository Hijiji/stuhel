<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
    <title>Stuhel My Page</title>
    <!-- Favicon-->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
    <!-- Bootstrap Icons-->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" rel="stylesheet" />
    <!-- Google fonts-->
    <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic" rel="stylesheet" type="text/css" />
    <!-- SimpleLightbox plugin CSS-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.css" rel="stylesheet" />
    <!-- Core theme CSS (includes Bootstrap)-->
    <link href="css/styles.css" rel="stylesheet" />
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">     flatpicker css -->
    <!--<script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script>     flatpicker min js -->
    <!--<script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>           flatpicker ko -->
    <!--sweet alert-->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <style>
.modal-wrapper {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
}
.modal-new {
  background: white;
  padding: 24px 16px;
  border-radius: 4px;
  width: 320px;
  align: center;
}
.modal-title {
  font-size: 30px;
  font-weight: bold;
  text-align: center;
}
.modal-p {
  font-size: 20px;
}
.close-wrapper {
  text-align: right;
}
    </style>
</head>

<body id="page-top">

<!-- Navigation-->
<nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container px-4 px-lg-5">
        <a class="navbar-brand" href="#page-top">My Page</a>
        <button class="navbar-toggler navbar-toggler-right" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarResponsive">
            <ul class="navbar-nav ms-auto my-2 my-lg-0">
                <li class="nav-item"><a class="nav-link" href="#about">About</a></li>
                <li class="nav-item"><a class="nav-link" href="#myInfo">회원정보</a></li>
                <li class="nav-item"><a class="nav-link" href="#bookStatus">예약현황</a></li>
                <li class="nav-item"><a class="nav-link" href="/home.html">Home</a></li>
                <li class="nav-item"><a class="nav-link" onclick="logoutButton()">Logout</a></li>
            </ul>
        </div>
    </div>
</nav>
<!-- Masthead-->
<header class="masthead" id="about">
    <div class="container px-4 px-lg-5 h-100">
        <div class="row gx-4 gx-lg-5 h-100 align-items-center justify-content-center text-center">
            <div class="col-lg-8 align-self-center">
                <h1 class="text-white font-weight-bold">MY PAGE</h1>
                <hr class="divider" />
            </div>
        </div>
    </div>
</header>

<!-- Services-->
<section class="page-section" id="myInfo">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8 col-xl-6 text-center">
                <h2 class="mt-0">회원정보</h2>
                <hr class="divider" />
            </div>
        </div>

        <div class="row gx-4 gx-lg-5 justify-content-center mb-5">
            <div class="col-lg-6">

                    <!-- Name input-->
                    <div class="form-floating mb-3">
                        <h6 class="mt-0"> NAME </h6> <input class="form-control" id="name" type="text" onkeyup="enterkeyEvent(identity)" disabled/>
                    </div>

                <!-- ID input-->
                    <div class="form-floating mb-3">
                        <h6 class="mt-0"> I D </h6><input class="form-control" id="identity" type="text" onkeyup="enterkeyEvent(birth)" disabled/><!--placeholder="ID" data-sb-validations="required" -->
                    </div>
                    <div>
                        <div class="text-center mb-3">
                            <div class="fw-bolder" id="idCheckResultMsg" style="color:tomato; font-size:18px;"></div>
                        </div>
                    </div>

                    <!-- ID DoubleCheck input-->
                    <div class="form-floating mb-3" id="idCheckDiv" style="display:none" >
                        <input class="btn btn-primary btn-xl" type="button" id="idDoubleCheck" value="ID중복확인"/>
                    </div>

                    <!-- birth input-->
                    <div class="form-floating mb-3">
                        <h6 class="mt-0"> BIRTH </h6><input class="form-control" id="birth" onkeyup="enterkeyEvent(password)" disabled/><!--placeholder="ID" data-sb-validations="required" -->
                    </div>
                    <div>
                        <div class="text-center mb-3">
                            <div class="fw-bolder" id="birthCheckResultMsg" style="color:tomato; font-size:18px;"></div>
                        </div>
                    </div>

                <!-- Password input-->
                    <div class="form-floating mb-3" id="pwDiv" style="display:none" >
                        <h6 class="mt-0"> NEW PW </h6><input class="form-control" id="password" type="password" onkeyup="enterkeyEvent(confirmPassword)" placeholder="Password" data-sb-validations="required"/>
                    </div>
                    <div>
                        <div class="text-center mb-3">
                            <div class="fw-bolder" id="pwCheckResultMsg" style="color:tomato; font-size:18px;"></div>
                        </div>
                    </div>

                <!-- Password confirm input-->
                    <div class="form-floating mb-3" id="pwConfirmDiv" style="display:none" >
                        <h6 class="mt-0"> PW CONFIRM</h6><input class="form-control" id="confirmPassword" type="password" /><!--placeholder="Password-Check" data-sb-validations="required" -->
                    </div>

                    <div>
                        <div class="text-center mb-3">
                            <div class="fw-bolder" id="confirmBeforeCheckMsg" style="color:tomato; font-size:18px;"></div>
                        </div>
                    </div>

                    <!--수정창 오픈-->
                    <div class="d-grid">
                        <input type="button" class="btn btn-primary btn-xl" id="changeButton" onclick="userInfoChange()" value="정보수정"/>
                    </div>
                    <!--수정저장-->
                    <div class="d-grid">
                        <input type="button"  class="btn btn-primary btn-xl" id="submitButton" value="완료" style="display:none"/>
                    </div>
                    <!--수정취소-->
                    <div class="d-grid">
                        <input type="button"class="btn btn-primary btn-xl" id="changeCancelButton"  style="display:none" value="수정취소" onClick="window.location.reload()"/>
                    </div>
            </div>
        </div>
    </div>
</section>

<!--예약현황 달력-->
<section class="page-section" id="bookStatus">
    <div class="container px-4 px-lg-5">
        <div class="row gx-4 gx-lg-5 justify-content-center">
            <div class="col-lg-8 col-xl-6 text-center">
                <h2 class="mt-0">예약현황</h2>
                <hr class="divider" />
            </div>
        </div>
        <div class="row gx-4 gx-lg-5 justify-content-center"><!-- mb-5-->
            <div class="col-lg-8 col-xl-6 text-center">
                <div>
                    <input type="button" class="btn btn-light btn-xl" onclick="minusMonth()" value="◀"> &nbsp;&nbsp;&nbsp;&nbsp;
                    <span id="year" style="font-size:xx-large;"> </span>년&nbsp;
                    <span id="month" style="font-size:xx-large;"> </span>월&nbsp;&nbsp;&nbsp;&nbsp;
                    <input type="button" class="btn btn-light btn-xl" onclick="plusMonth()" value="▶">
                </div>
            </div>
            <div class="row gx-4 gx-lg-5 justify-content-center">
                <div class="col-lg-8 col-xl-6 text-center">
                    <table id="tableTag">
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<!--회원정보수정 사용자확인 모달-->
<div class="modal-wrapper" id="userCheckModal"  style="display: none;">
    <div class="modal-new">
        <div class="modal-title">사용자 확인</div>
        <hr class="divider" />
        <div>
            I  D  <input class="form-control" type="text" onkeyup="enterkeyEvent(checkPw)" id="checkId"/>
            P W  <input class="form-control" type="password" onkeyup="enterkeyEvent(idPwConfirm)" id="checkPw"/>
        </div>
        </br>
        <div class="fw-bolder" id="checkMsg" style="color:#1a1e21;"></div>
        </br>
        <div class="close-wrapper">
            <button class="btn btn-light btn-xl" id="idPwConfirm" onclick="idPwConfirmFunc()">확인</button>&nbsp;&nbsp;
            <button class="btn btn-light btn-xl" value="userCheckModalClose" onclick="modalClose(this)" >닫기</button>
        </div>
    </div>
</div>


<!--회의실 예약현황 모달-->
<div class="modal-wrapper" id="bookConditionModal" style="display: none;">
    <div class="modal-new">
        <div class="modal-title">세미나실 예약현황</div>
        <hr class="divider" />
        <div class="modal-p" style="text-align:center;">
            <span id="bookCModalYear"></span>년&nbsp;&nbsp;
            <span id="bookCModalMonth"></span>월&nbsp;&nbsp;
            <span id="bookCModalDate"></span>일<br/><br/>
            <div id="bookRoomAndTimeDiv"></div>
        </div><br/>
        <div class="close-wrapper">
            <button class="btn btn-light btn-xl" value="bookCondiModalClose" style="color:tomato;"onclick="cancelBook()" >예약취소</button>&nbsp;
            <button class="btn btn-light btn-xl" value="bookCondiModalClose" onclick="modalClose(this)" >닫기</button>
        </div>
    </div>
</div>


<!-- Footer-->
<footer class="bg-light py-5">
    <div class="container px-4 px-lg-5"><div class="small text-center text-muted">Copyright &copy; 2022 - isjiji</div></div>
</footer>

<!-- Bootstrap core JS-->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- SimpleLightbox plugin JS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/SimpleLightbox/2.1.0/simpleLightbox.min.js"></script>
<!-- Core theme JS-->
<script src="js/scripts.js"></script>
<script src="https://cdn.startbootstrap.com/sb-forms-latest.js"></script>

<script>
    let dbName = "";
    let dbIdentity = "";
    let dbBirth = "";

    const changeButton = document.querySelector("#changeButton");
    const submitButton = document.querySelector("#submitButton");
    const name = document.querySelector("#name");
    const identity = document.querySelector("#identity");
    const birth = document.querySelector("#birth");
    const password = document.querySelector("#password");
    const confirmPassword = document.querySelector("#confirmPassword");

    const idCheckDiv = document.querySelector("#idCheckDiv");
    const pwDiv = document.querySelector("#pwDiv");
    const pwConfirmDiv = document.querySelector("#pwConfirmDiv");
    const changeCancelButton = document.querySelector("#changeCancelButton");

    const userCheckModal = document.querySelector("#userCheckModal");
    const checkId = document.querySelector("#checkId");
    const checkPw = document.querySelector("#checkPw");
    const checkMsg = document.querySelector("#checkMsg");
    const idCheckResultMsg = document.querySelector("#idCheckResultMsg");
    const idPwConfirm = document.querySelector("#idPwConfirm");

    const bookConditionModal = document.querySelector("#bookConditionModal");

    let tdTagIdArr=[];
    let monthBookDataArr=[];
    let clickedBookData=[];

    <!--세션체크-->
    let sessionStatus = null;
    (function(){
        let xhr = new XMLHttpRequest();
        xhr.open('Get', "/session/sessionCheck"
                 ,true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.send();
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // 데이터 확인
                sessionStatus = xhr.responseText;
                if(sessionStatus==-1){
                    location.href="/index.html";
                }else if(sessionStatus==0){
                    retrieveMemberInfo();
                }
            }
        }
    })();

    <!--초기회원정보화면-->
    function retrieveMemberInfo(){
        if(sessionStatus==0){
            let xhr = new XMLHttpRequest();
                xhr.open('POST', "/stuhel/myPage/retrieveMemberInfo?"
                        ,true);
                xhr.setRequestHeader('Accept', 'application/json');
                xhr.send();
                xhr.onreadystatechange = () => {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // 데이터 확인
                        let txt = xhr.responseText;
                        txt = JSON.parse(txt);

                        dbName=txt.name;
                        dbIdentity=txt.id;
                        dbBirth=txt.birth;

                        name.value=dbName;
                        identity.value=dbIdentity;
                        birth.value=dbBirth;
                    }
                }
                setDate();
        }
    }

    function enterkeyEvent(next){
        if(event.keyCode == 13){
            next.focus();
        }
    }

    <!--달력-->
    const today = new Date();
    let choiceMonth=today.getMonth();
    let choiceYear=today.getFullYear();
    let bookCalendar = document.querySelector("#bookCalendar");
    const month=document.querySelector("#month");
    const year=document.querySelector("#year");

    function setDate(){
            year.innerHTML=choiceYear;
            month.innerHTML=choiceMonth+1;
            retrieveBookStatus(choiceYear,choiceMonth);

    }
    function minusMonth(){
        if(choiceYear>=today.getFullYear()){
            if(choiceMonth==0){
                choiceMonth=11;
                choiceYear--;
            }else
                choiceMonth--;
            setDate();
        }
    }
    function plusMonth(){
        if(new Date(choiceYear,choiceMonth) < new Date(today.getFullYear()+1,today.getMonth()-1)){
            if(choiceMonth==11) {
                choiceMonth=0;
                choiceYear++;
            } else
                choiceMonth++;
            setDate();
        }
    }
    function createCalendar(choiceYear,choiceMonth,tdTagIdArr){
        tableTag.innerHTML="";
        const dayArray=["일","월","화","수","목","금","토"];
        let lastDate =new Date(choiceYear,choiceMonth,0).getDate();
        let firstBlankNum=new Date(choiceYear,choiceMonth).getDay();
        let firstLineDayNum=7-firstBlankNum;
        let lineNum=5;
        let firstDay=1;
        if(firstBlankNum+lastDate > 35) lineNum=6;

        for(var line=0;line<=lineNum;line++){
            let trTag=document.createElement("tr");
            for(var j=0;j<7;j++){
                let tdTag=document.createElement("td");
                if(line==0){
                    tdTag.innerHTML = dayArray[j];
                }else if(line==1){
                    if(j<firstBlankNum) tdTag.innerHTML ="&nbsp";
                    else{
                        tdTag.id="date"+firstDay;
                        tdTag.innerHTML = firstDay++;
                        tdTag.onclick = () =>{tdDateClick(tdTag.id);}
                    }
                }else{
                    if(firstDay>lastDate)
                        tdTag.innerHTML="&nbsp;";
                    else{
                        tdTag.id="date"+firstDay;
                        tdTag.innerHTML=firstDay++;
                        tdTag.onclick = () =>{tdDateClick(tdTag.id);}
                    }
                }
                for(let i=0;i<tdTagIdArr.length;i++){
                    if(tdTag.id == tdTagIdArr[i]) tdTag.style.color="tomato";
                }
                tdTag.style.height="60px";
                tdTag.style.width="80px";
                tdTag.style.textAlign="center";
                trTag.appendChild(tdTag);
            }
            tableTag.appendChild(trTag);
        }
    }

    <!--달력에 띄울 세미나실 예약현황 조회-->
    function retrieveBookStatus(choiceYear,choiceMonth){
        let cMonth= month.innerHTML;
        let cYear= year.innerHTML;
        if(cMonth<10)cMonth="0"+cMonth;
        let retrieveYM=cYear+"-"+cMonth;
            console.log("조회연월"+retrieveYM);
        let bookStatusData={"bookDate":retrieveYM};
        bookStatusData = JSON.stringify(bookStatusData);
        if(sessionStatus==0){
            let xhr = new XMLHttpRequest();
                xhr.open('POST', "/stuhel/myPage/retrieveBookStatus?bookStatusData="+encodeURI(bookStatusData)
                        ,true);
                xhr.setRequestHeader('Accept', 'application/json');
                xhr.send();
                xhr.onreadystatechange = () => {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        // 데이터 확인
                        let txt = xhr.responseText;
                        monthBookDataArr = JSON.parse(txt);
                        console.log(monthBookDataArr);
                        tdTagIdArr=[];
                        if(monthBookDataArr.length>0){
                            for(var i=0;i<monthBookDataArr.length;i++){
                                let bookDate;
                                if(monthBookDataArr[i].bookDate.substr(8,1)!="0") bookDate=monthBookDataArr[i].bookDate.substr(8,2);
                                else bookDate=monthBookDataArr[i].bookDate.substr(9,1);
                                tdTagId = "date"+bookDate;
                                tdTagIdArr.push(tdTagId);
                            }

                        }
                        createCalendar(choiceYear,choiceMonth,tdTagIdArr);
                    }
                }
        }
    }
    <!--달력모달 onclick-->
    function tdDateClick(clickedTdId){
        bookTimeArr=[];
        bookRoomIdArr=[];
        clickedBookData=[];
        for(let i=0; i<monthBookDataArr.length; i++){
            if(parseInt(monthBookDataArr[i].bookDate.slice(8))==parseInt(clickedTdId.slice(4))){
                bookTimeArr.push(monthBookDataArr[i].bookTime);
                bookRoomIdArr.push(monthBookDataArr[i].roomId);
            }
            if(parseInt(monthBookDataArr[i].bookDate.slice(8))==parseInt(clickedTdId.slice(4))){
            let dataInfo=new Object();
                dataInfo.roomId=monthBookDataArr[i].roomId;
                dataInfo.bookTime=monthBookDataArr[i].bookTime;
                dataInfo.bookDate=monthBookDataArr[i].bookDate;
                dataInfo.userId=monthBookDataArr[i].userId;
                dataInfo.bookId=monthBookDataArr[i].bookId;
                clickedBookData.push(dataInfo);
            }
        }
        console.log("clickedBookData");
        console.log(clickedBookData);
        for(let i=0;i<tdTagIdArr.length;i++){
            if(tdTagIdArr[i]==clickedTdId){
                let clickedDate = clickedTdId.slice(4);
                if(clickedDate.length==1) clickedDate="0"+clickedDate;

                bookConditionModal.style.display="flex";
                bookCModalYear.innerHTML=choiceYear;
                bookCModalMonth.innerHTML=choiceMonth;
                bookCModalDate.innerHTML=clickedDate;

                for(let j=0; j<bookTimeArr.length;j++){
                    let firstBookTime = parseInt(bookTimeArr[j]);
                    let lastBookTime = firstBookTime+1;
                    let bookTime = firstBookTime+":00 ~ "+lastBookTime+":00";

                    if(firstBookTime<10)  bookTime="0"+firstBookTime+":00 ~ "+lastBookTime+":00";
                    if(lastBookTime<10)  bookTime=firstBookTime+":00 ~ 0"+lastBookTime+":00";

                    let bookTimeTag = document.createElement("span");
                    let bookRoomIdTag = document.createElement("span");
                    bookRoomIdTag.innerHTML+=bookRoomIdArr[j]+"&nbsp;호&nbsp;&nbsp;▶&nbsp;";
                    bookTimeTag.innerHTML+=bookTime+"<br/>";
                    bookRoomAndTimeDiv.appendChild(bookRoomIdTag);
                    bookRoomAndTimeDiv.appendChild(bookTimeTag);
                }
                return;
            }
        }
    }
    <!--예약취소-->
    function cancelBook(){
        swal({
                  title : '세미나실 예약 취소'
                , text : 'ヽ(✿ﾟ▽ﾟ)ノ \n'
                        +'세미나실 예약을 취소합니다.'
                , buttons : ["닫기","확인"]
                , confirmButtonColor : 'tomato'
        }).then(function(result){
                console.log(result);
                if(result==null) return;
                else {
                    let cancelBookData = JSON.stringify(clickedBookData);
                        console.log("cancelBookData");
                        console.log(cancelBookData);
                    let xhr = new XMLHttpRequest();
                    xhr.open('POST',  "/stuhel/myPage/cancelBook?"
                                        + "bcancelBookData=" + encodeURI(cancelBookData)
                            ,true);
                    xhr.setRequestHeader('Accept', 'application/json');
                    xhr.send();
                    xhr.onreadystatechange = () => {
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            // 데이터 확인
                            let txt = xhr.responseText;
                            txt = JSON.parse(txt);
                            console.log(txt.errorCode);
                            if (txt.errorCode == "N" ) {
                                alert("예약취소를 실패하였습니다. 동일한 현상이 반복될 경우 소비자실로 연락바랍니다.");
                                return;
                            } else {
                                alert("예약취소가 성공적으로 완료되었습니다.");
                            }
                            modalClose("bookCondiModalClose");
                            retrieveBookStatus(choiceYear,choiceMonth);
                        }
                    }
                }
        });
    }

    <!--회원정보수정 modal onclick-->
    function userInfoChange(){
        userCheckModal.style.display="flex";
        checkId.focus();
    }

    <!--회원정보수정시 회원인증-->
    function idPwConfirmFunc(){
        if(checkPw.value.trim()==null||checkPw.value.trim()=="" ||
           checkId.value.trim()==null||checkId.value.trim()==""
        ){
           checkMsg.innerHTML = "※ ID 혹은 비밀번호를 입력해주세요";
           return;
        }else if(dbIdentity!=checkId.value.trim()){
           checkMsg.innerHTML = "※ 잘못된 ID를 입력하셨습니다.";
           return;
        }else{
           let loginData = {"password":checkPw.value, "id":checkId.value}
           loginData = JSON.stringify(loginData);

           let xhr = new XMLHttpRequest();
           xhr.open('POST', "/member/login?"
               + "loginData=" + encodeURI(loginData)
               ,true);
           xhr.setRequestHeader('Accept', 'application/json');
           xhr.send();
           xhr.onreadystatechange = () => {
               if (xhr.readyState == 4 && xhr.status == 200) {
                   // 데이터 확인
                   let txt = xhr.responseText;
                   txt = JSON.parse(txt);
                   if (txt.errorCode == -1 || txt.errorCode == -2 ) {
                      checkMsg.innerHTML = "※ " + txt.errorMsg;
                       return;
                   } else {
                      userCheckModal.style.display = "none";
                      name.disabled=false;
                      identity.disabled=false;
                      birth.disabled=false;
                      password.style.display="block";
                      idCheckDiv.style.display="block";
                      pwDiv.style.display="block";
                      pwConfirmDiv.style.display="block";
                      changeButton.style.display="none";
                      submitButton.style.display="block";
                      changeCancelButton.display="block";
                      checkPw.value="";
                      checkId.value="";
                      checkMsg.innerHTML="";
                      name.value = dbName;
                      identity.value  = dbIdentity;
                      birth.value  = dbBirth;
                   }
               }
           }
        }
    }

    <!--모달 닫기-->
    function modalClose(modalType){
        if(modalType.value=="userCheckModalClose"){
            userCheckModal.style.display = "none";
            checkPw.value="";
            checkId.value="";
            checkMsg.innerHTML="";
            return;
            }
        if(modalType.value=="bookCondiModalClose" || modalType=="bookCondiModalClose"){
            bookConditionModal.style.display = "none";
            bookCModalYear.innerHTML="";
            bookCModalMonth.innerHTML="";
            bookRoomAndTimeDiv.innerHTML="";
            return;
        }

    };

    <!--아이디 더블체크-->
    idDoubleCheck.addEventListener('click', () => {
        var regExp=/^[a-z0-9]*$/;
        if(identity.value.trim()==""||identity.value.trim()==null){
            idCheckResultMsg.innerHTML="ID를 입력해주세요";
            idDoubleCheck.value="ID중복확인";
            return;
        }else if( !regExp.test(identity.value.trim()) || identity.value.trim().length < 5 ||identity.value.trim().length > 20){
            idCheckResultMsg.innerHTML = "※ 아이디는 5~20자 영문 소문자와 숫자만으로 구성되어야합니다.";
            idDoubleCheck.value="ID중복확인";
            identity.focus();
            return;
        }
        let xhr = new XMLHttpRequest();
        xhr.open('Get', "/member/idDoubleCheck?"
            + "identity=" + identity.value
            ,true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.send();
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
                // 데이터 확인
                let txt = xhr.responseText;
                txt = JSON.parse(txt);
                if (txt.errorCode < 0) {
                    idCheckResultMsg.innerHTML="※ 이미 사용중인 아이디입니다.";
                    idDoubleCheck.value="ID중복확인";
                    return;
                }
                idCheckResultMsg.innerHTML="※ 사용 가능한 아이디입니다.";
                idDoubleCheck.value="사용가능";
            }
        }
    });
    let changeName="" ;
    let changeIdentity="";
    let changeBirth="";
    let changePassword="";

    submitButton.addEventListener('click',()=>{
    idCheckResultMsg.innerHTML=""; idCheckResultMsg.innerHTML="";birthCheckResultMsg.innerHTML="";pwCheckResultMsg.innerHTML="";
        if (identity.value.trim()==""||identity.value==null
            ||name.value.trim()==""||name.value==null
            ||birth.value.trim()==""||birth.value==null
            ){
           idCheckResultMsg.innerHTML ="※ ID, 이름, 생년월일은 비워둘 수 없습니다.";
        }
        if(name.value.trim()!=dbName){
            changeName=name.value.trim();
        }if(identity.value.trim()!=dbIdentity){
            if(idDoubleCheck.value=="사용가능"){
                changeIdentity=identity.value.trim();

            }else{
                idCheckResultMsg.innerHTML="※ 변경 아이디 중복체크가 필요합니다.";
                return;
            }
        }if(birth.value.trim()!=dbBirth){
            if(isNaN(birth.value)||birth.value.length != 8){
                birthCheckResultMsg.innerHTML="※ 8자리 숫자만 입력가능합니다. ex) 19450815";
                return;
            }else {
                changeBirth=birth.value.trim();
            }
        }else changeBirth=dbBirth;
        if(password.value!=null || password.value.trim()!="" && confirmPassword.value!=null || confirmPassword.value.trim()!=""){
            if(password.value==confirmPassword.value){
                changePassword=password.value.trim();

            }else{
                pwCheckResultMsg.innerHTML="입력한 비밀번호를 확인해주세요.";
                return;
            }
        }
        swal({
                  title : '회원정보 변경'
                , text : 'ヽ(✿ﾟ▽ﾟ)ノ \n'
                        +'변경된 정보를 저장하시겠습니까?'
                , buttons : ["취소","확인"]
                , confirmButtonColor : 'tomato'
        }).then(function(result){
                console.log(result);
                if(result==null) return;
                else {
                    let changeMemberInfo = {"birth":changeBirth,"password":changePassword,"id":changeIdentity,"name":changeName} //데이터 추가하기
                    changeMemberInfo = JSON.stringify(changeMemberInfo);

                    let xhr = new XMLHttpRequest();
                    xhr.open('POST',  "/stuhel/myPage/changeMemberInfo?"
                                        + "changeMemberInfo=" + encodeURI(changeMemberInfo)
                            ,true);
                    xhr.setRequestHeader('Accept', 'application/json');
                    xhr.send();
                    xhr.onreadystatechange = () => {
                        if (xhr.readyState == 4 && xhr.status == 200) {
                            // 데이터 확인
                            let txt = xhr.responseText;
                            txt = JSON.parse(txt);
                            console.log(txt.errorCode);
                            console.log(txt.errorMsg);
                            if (txt.errorCode == -1 || txt.errorCode == -2 ) {
                                alert(errMsg);
                                return;
                            } else {
                                alert("변경이 완료되었습니다.");
                            }
                            name.disabled=true;
                            identity.disabled=true;
                            birth.disabled=true;
                            password.style.display="none";
                            idCheckDiv.style.display="none";
                            pwDiv.style.display="none";
                            pwConfirmDiv.style.display="none";
                            changeButton.style.display="block";
                            submitButton.style.display="none";
                            changeCancelButton.display="none";
                            name.value = dbName;
                            identity.value  = dbIdentity
                            birth.value  = dbBirth;
                            idDoubleCheck.value="ID중복확인";
                            password.value="";
                            confirmPassword.value="";
                            idCheckResultMsg.innerHTML="";
                            pwCheckResultMsg.innerHTML="";
                            birthCheckResultMsg.innerHTML="";
                            confirmBeforeCheckMsg.innerHTML="";
                            retrieveMemberInfo();
                        }
                    }
                }
        });
    });

    /*로그아웃*/
    function logoutButton(){
        let xhr = new XMLHttpRequest();
        xhr.open('Post', "/session/logout"
            ,true);
        xhr.setRequestHeader('Accept', 'application/json');
        xhr.send();
        xhr.onreadystatechange = () => {
            if (xhr.readyState == 4 && xhr.status == 200) {
                location.href="/index.html";
            }
        }
    }
</script>
</body>
</html>
